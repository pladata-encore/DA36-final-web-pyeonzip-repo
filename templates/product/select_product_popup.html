<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì œí’ˆ ì„ íƒ</title>

    <style>
        .btn-primary{
            width:8%;
            margin-bottom : 10px;
            margin-top: 10px;
            height:30px;
        }
        .search{
            height:30px;
            margin-top:10px;
            margin-bottom: 10px;
            margin-right: 5px;
        }

        .product-item {
            display: flex;
            align-items: center;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            justify-content: space-between;
        }

        .product-item img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            margin-right: 15px;
            border-radius: 5px;
        }

        .product-info {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .product-tags {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }

        .tag {
            background-color: #f1f1f1;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 12px;
        }

        .select-btn {
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .select-btn:hover {
            background-color: #0056b3;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

</head>

<body>
    <!-- ğŸ” ì¥ê³  ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€ -->
    <form class="d-flex" method="get" action="{% url 'product:select_product' %}">
        <input type="text" name="q" class="form-control search" placeholder="ì œí’ˆì„ ê²€ìƒ‰í•˜ì„¸ìš”..." value="{{ query|default:'' }}">
        <button type="submit" class="btn btn-primary">ê²€ìƒ‰</button>
    </form>

    <!-- ğŸ“œ ê²€ìƒ‰ëœ ì œí’ˆ ëª©ë¡ -->
    <div id="productList">
        {% for p in page_obj %}
            <div class="product-item">
                <span>{{ forloop.counter }}</span> <!-- ìˆœë²ˆ ì¶”ê°€ -->
                <img src="{{ p.product_image_url }}" alt="ì œí’ˆ ì´ë¯¸ì§€">
                <div class="product-info">
                    <p class="product-name"><strong>{{ p.product_name }}</strong></p>
                    <div class="product-tags">
                        <span class="tag">{{ p.product_price }}ì›</span>
                        <span class="tag">{{ p.convenient_store_name }}</span>
                        <span class="tag">{{ p.product_category_name }}</span>
                    </div>
                </div>
                <button class="select-btn" onclick="selectProduct('{{ p.product_id }}', '{{ p.product_name }}', '{{ p.product_image_url }}','{{ p.product_price }}', '{{ p.convenient_store_name }}', '{{ p.product_category_name }}')">ì„ íƒ</button>
            </div>
        {% empty %}
            <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
        {% endfor %}
    </div>

        <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center">
            <!-- ì´ì „í˜ì´ì§€ ì˜ì—­ ì‹œì‘ -->
            {% if page_obj.previous_page_number|add:-4 >= 0 %}
                <li class="page-item">
                    <a class="page-link" href="{% url 'product:select_product' %}?page={{ page_obj.previous_page_number|add:-3 }}">Previous</a>
                </li>
            {% endif %}
            <!-- ì´ì „í˜ì´ì§€ ì˜ì—­ ë -->

            <!-- í˜ì´ì§€ë„˜ë²„ ì˜ì—­ ì‹œì‘ -->
            {% for page_number in page_obj.paginator.page_range %}
                {# í˜„ì¬í˜ì´ì§€ ê¸°ì¤€ ì•ë’¤ 3ê°œê¹Œì§€ë§Œ í‘œì‹œ (4 ~ 7 ë§í¬ í‘œì‹œ) #}
                {% if page_number >= page_obj.number|add:-3 and page_number <= page_obj.number|add:3 %}
                    {% if page_number == page_obj.number %}
                        {# í˜„ì¬í˜ì´ì§€ì¸ ê²½ìš° #}
                        <li class="page-item active"><a class="page-link" href="#">{{ page_number }}</a></li>
                    {% else %}
                        {# í˜„ì¬í˜ì´ì§€ê°€ ì•„ë‹Œ ê²½ìš° #}
                        <li class="page-item">
                            <a class="page-link" href="{% url 'product:select_product' %}?page={{ page_number }}&q={{ query|default:'' }}">{{ page_number }}</a>
                        </li>
                    {% endif %}
                {% endif %}

            {% endfor %}
            <!-- í˜ì´ì§€ë„˜ë²„ ì˜ì—­ ë -->

            <!-- ë‹¤ìŒí˜ì´ì§€ ì˜ì—­ ì‹œì‘ -->
            {% if last_page >= page_obj.number|add:4 %}

                <li class="page-item">
                    <a class="page-link" href="{% url 'product:select_product' %}?page={{ page_obj.next_page_number|add:+3 }}">Next</a>
                </li>
            {% endif %}
            <!-- ë‹¤ìŒí˜ì´ì§€ ì˜ì—­ ë -->
        </ul>
    </nav>


    <script>
    function selectProduct(productId, productName, productImageUrl, productPrice, productStore, productCategory) {
        window.opener.setSelectedProduct(productId, productName, productImageUrl, productPrice, productStore, productCategory);  // ë¶€ëª¨ ì°½ì˜ í•¨ìˆ˜ í˜¸ì¶œ
        window.close();  // íŒì—… ë‹«ê¸°
    }
    </script>

</body>
</html>
