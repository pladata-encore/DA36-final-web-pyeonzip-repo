{% extends '../layout/base.html' %}

{% load static %}
{% block content %}

<div class="container">
    <div class="row">
        <div class="col-md-2">
            <div class="card mb-3" style="max-width: 100%; height: 130px;">
                <div class="card-body">
                    <div><label>
                        <input type="radio" name="store" value="ALL" onclick="filterProducts('ALL')" checked>
                        ALL
                    </label></div>
                    <div><label>
                        <input type="radio" name="store" value="CU" onclick="filterProducts('CU')">
                        CU
                    </label></div>
                    <div><label>
                        <input type="radio" name="store" value="GS25" onclick="filterProducts('GS25')">
                        GS25
                    </label></div>
                    <div> <label>
                        <input type="radio" name="store" value="7-ELEVEN" onclick="filterProducts('7-ELEVEN')">
                        7-ELEVEN
                    </label></div>
                </div>
            </div>
            <div class="card mb-3" style="max-width: 100%; height: 130px;">
                <div class="card-body">
                    <div><label>
                        <input type="radio" name="category" value="all" onclick="filterProductss('ê°„í¸ì‹í’ˆ')" checked>
                        ê°„í¸ì‹í’ˆ
                    </label></div>
                    <div><label>
                        <input type="radio" name="category" value="cu" onclick="filterProductss('ê³¼ìë¥˜')">
                        ê³¼ìë¥˜
                    </label></div>
                    <div><label>
                        <input type="radio" name="category" value="cu" onclick="filterProductss('ì•„ì´ìŠ¤í¬ë¦¼')">
                        ì•„ì´ìŠ¤í¬ë¦¼
                    </label></div>
                    <div> <label>
                        <input type="radio" name="category" value="cu" onclick="filterProductss('ìŒë£Œ')">
                        ìŒë£Œ
                    </label></div>
                </div>
            </div>
        </div>

        <div class="col-md-10">
            <div class="product-tab-btn">
                <button class="product-tab-btn btn btn-primary" onclick="openTab('all')">ALL</button>
                <button class="product-tab-btn btn" onclick="openTab('latest')">LATEST</button>
                <button class="product-tab-btn btn" onclick="openTab('ai')">AI</button>
            </div>

            <div id="product-tab-contents">
                {% for product in page_obj %}
                    <div class="card mb-3" style="max-width: 100%; height: 300px;">
                       <button type="button" class="btn">
                            <a href="{% url 'product:product_detail' product_id=product.product_id %}" class="text-decoration-none">
                              <div class="row g-0">
                                <div class="col-md-4">
                                    {% if product.product_image_url %}
                                        <img src="{{ product.product_image_url }}"  style="width:300px; height:300px;" alt="...">
                                    {% else %}
                                        <img src="{% static 'images/logo.png' %}" class="rounded-circle" width="26"/>
                                    {% endif%}
                                </div>
                                <div class="col-md-8">
                                  <div class="card-body">
                                    <h5 class="card-title">{{ product.product_name }}</h5>
                                    <p class="card-text">{{ product.product_price }}ì›</p>
                                    <p class="card-text"><small class="text-body-secondary">{{ product.convenient_store_name }}</small></p>
                                    <span class="card-text"><small class="text-body-secondary">â¤ï¸:{{ product.likes.count }}</small></span>
                                    <span class="card-text"><small class="text-body-secondary">ğŸ—¯ï¸:{{ product.Product_reviews.count }}</small></span>
                                  </div>
                                </div>
                              </div>
                            </a>
                        </button>

                    </div>
                {% endfor %}
                     <!-- í˜ì´ì§• ì²˜ë¦¬ ì‹œì‘ -->
                 <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-center">
                        <!-- ì´ì „í˜ì´ì§€ ì˜ì—­ ì‹œì‘ -->
                       {% if page_obj.previous_page_number|add:-4 >= 0 %}
                                <li class="page-item">
                                    <a class="page-link" href="{% url 'product:product_list' tab='all' %}?page={{ page_obj.previous_page_number|add:-3 }}">Previous</a>
                                </li>
                        {% endif %}
                        <!-- ì´ì „í˜ì´ì§€ ì˜ì—­ ë -->

                        <!-- í˜ì´ì§€ë„˜ë²„ ì˜ì—­ ì‹œì‘ -->
                        {% for page_number in page_obj.paginator.page_range %}
                            {# í˜„ì¬í˜ì´ì§€ ê¸°ì¤€ ì•ë’¤ 3ê°œê¹Œì§€ë§Œ í‘œì‹œ (4 ~ 7 ë§í¬ í‘œì‹œ) #}
                            {% if page_number >= page_obj.number|add:-3 and page_number <= page_obj.number|add:3 %}
                                {% if page_number == page_obj.number %}
                                    {# í˜„ì¬í˜ì´ì§€ì¸ ê²½ìš° #}
                                    <li class="pagination-link active"><a class="page-link" href="#">{{ page_number }}</a></li>
                                {% else %}
                                    {# í˜„ì¬í˜ì´ì§€ê°€ ì•„ë‹Œ ê²½ìš° #}
                                    <li class="page-item">
                                        <a class="page-link" href="{% url 'product:product_list' tab='all' %}?page={{ page_number }}">{{ page_number }}</a>
                                    </li>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        <!-- í˜ì´ì§€ë„˜ë²„ ì˜ì—­ ë -->

                    <!-- ë‹¤ìŒí˜ì´ì§€ ì˜ì—­ ì‹œì‘ -->
                    {% if last_page >= page_obj.number|add:4 %}
                        <li class="page-item">
                                    <a class="page-link" href="{% url 'product:product_list' tab='all' %}?page={{ page_obj.next_page_number|add:+3 }}">Next</a>
                        </li>
                    {% endif %}
                <!-- ë‹¤ìŒí˜ì´ì§€ ì˜ì—­ ë -->
                    </ul>
                </nav>
    <!-- í˜ì´ì§• ì²˜ë¦¬ ë -->
        </div>


    </div>

</div>


</div>
{% endblock content %}
{% block script %}
<script>

    function openTab(tabName='all') {

        // ëª¨ë“  ë²„íŠ¼ì—ì„œ active í´ë˜ìŠ¤ë¥¼ ì œê±°
        let tabButtons = document.getElementsByClassName("product-tab-btn");
        for (let i = 0; i < tabButtons.length; i++) {
            tabButtons[i].classList.remove("btn-primary");
            tabButtons[i].classList.add("btn");
        }

        // ì„ íƒëœ íƒ­ ë‚´ìš© í‘œì‹œ

        // ì„ íƒëœ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€
        let selectedButton = document.querySelector(`button[onclick="openTab('${tabName}')"]`);
        selectedButton.classList.add("btn-primary");
        console.log(tabName)
        // AJAX ìš”ì²­ì„ í†µí•´ HTML ì½”ë“œ ì¡°ê° ë°›ì•„ì˜¤ê¸°
        fetch(`/product/product_list/${tabName}/`)
            .then(response => response.text())
            .then(html => {
                // ì„ íƒëœ íƒ­ì— HTML ì½”ë“œ ì‚½ì…
                document.getElementById("product-tab-contents").innerHTML = html;
            })
            .catch(error => {
                console.error('Error fetching HTML:', error);
                document.getElementById(tabName).innerHTML = '<p>Failed to load content.</p>';
            });

    }



        function filterProducts(store = 'ALL', category = null) {
        // ì„ íƒëœ ìŠ¤í† ì–´ì™€ ì¹´í…Œê³ ë¦¬ ê°’ì„ ê°€ì ¸ì˜´
        const selectedStore = store || document.querySelector("input[name='store']:checked").value;
        console.log(selectedStore)
        localStorage.setItem("selectedStoreFilter", store);
        const selectedCategory = category || document.querySelector("input[name='category']:checked").value;

        // fetch ìš”ì²­ìœ¼ë¡œ í•„í„°ë§ëœ ì œí’ˆ ê°€ì ¸ì˜¤ê¸°
        fetch(`/product/filter_products/${store}/`)
            .then(response => response.text())  // JSONì´ ì•„ë‹ˆë¼ HTMLì´ë¯€ë¡œ `.text()` ì‚¬ìš©
            .then(html => {
                document.getElementById("product-tab-contents").innerHTML = html;
            });
        }




    {#let currentPage = 1;#}
    {#let currentStore = "ALL"; // ê¸°ë³¸ê°’ ì„¤ì •#}
    {##}
    {#// ìƒí’ˆ í•„í„°ë§ & í˜ì´ì§€ë„¤ì´ì…˜ AJAX ìš”ì²­ í•¨ìˆ˜#}
    {#function filterProducts(store , page = 1) {#}
    {#    let currentStore = store;#}
    {#    let currentPage = page;#}
    {##}
    {#    fetch(`{% url 'product:filter_products' %}?store=${store}&page=${page}`)#}
    {#        .then(response => response.json())#}
    {#        .then(data => {#}
    {#            let productList = document.getElementById("all_product_tab");#}
    {#            productList.innerHTML = ""; // ê¸°ì¡´ ëª©ë¡ ë¹„ìš°ê¸°#}
    {##}
    {#            // ë°›ì•„ì˜¨ ìƒí’ˆ ë°ì´í„° ì¶”ê°€#}
    {#            data.products.forEach(product => {#}
    {#                let productCard = `#}
    {#                    <div class="card mb-3" style="max-width: 100%; height: 300px;">#}
    {#                        <button type="button" class="btn">#}
    {#                            <a href="{% url 'product:product_detail' product_id=product.id %}" class="text-decoration-none">#}
    {##}
    {#                                <div class="row g-0">#}
    {#                                    <div class="col-md-4">#}
    {#                                        <img src="${product.image || '/static/images/logo.png'}" style="width:300px; height:300px;" alt="...">#}
    {#                                    </div>#}
    {#                                    <div class="col-md-8">#}
    {#                                        <div class="card-body">#}
    {#                                            <h5 class="card-title">${product.name}</h5>#}
    {#                                            <p class="card-text">${product.price}ì›</p>#}
    {#                                            <p class="card-text"><small class="text-body-secondary">${product.store}</small></p>#}
    {#                                            <span class="card-text"><small class="text-body-secondary">â¤ï¸:${product.likes}</small></span>#}
    {#                                            <span class="card-text"><small class="text-body-secondary">ğŸ—¯ï¸:${product.reviews}</small></span>#}
    {#                                        </div>#}
    {#                                    </div>#}
    {#                                </div>#}
    {#                            </a>#}
    {#                        </button>#}
    {#                    </div>#}
    {#                `;#}
    {#                productList.innerHTML += productCard;#}
    {#            });#}
    {##}
    {#            // í˜ì´ì§€ë„¤ì´ì…˜ ì—…ë°ì´íŠ¸#}
    {#            updatePagination(data.total_pages);#}
    {#        })#}
    {#        .catch(error => console.error("Error:", error));#}


{#function updatePagination(currentPage, totalPages) {#}
{#    let paginationDiv = document.querySelector(".pagination");#}
{#    paginationDiv.innerHTML = ""; // ê¸°ì¡´ ë²„íŠ¼ ì´ˆê¸°í™”#}
{##}
{#    // ì´ì „ í˜ì´ì§€ ë²„íŠ¼#}
{#    if (currentPage > 1) {#}
{#        let prevButton = document.createElement("li");#}
{#        prevButton.className = "page-item";#}
{#        prevButton.innerHTML = `<a class="page-link" href="#" onclick="filterProducts(currentStore, ${Math.max(1, currentPage - 3)}); return false;">Previous</a>`;#}
{#        paginationDiv.appendChild(prevButton);#}
{#    }#}
{##}
{#    // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼#}
{#    let startPage = Math.max(1, currentPage - 3);#}
{#    let endPage = Math.min(totalPages, currentPage + 3);#}
{##}
{#    for (let i = startPage; i <= endPage; i++) {#}
{#        let pageItem = document.createElement("li");#}
{#        pageItem.className = (i === currentPage) ? "pagination-link active" : "page-item";#}
{#        pageItem.innerHTML = `<a class="page-link" href="#" onclick="filterProducts(currentStore, ${i}); return false;">${i}</a>`;#}
{#        paginationDiv.appendChild(pageItem);#}
{#    }#}
{##}
{#    // ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼#}
{#    if (currentPage < totalPages) {#}
{#        let nextButton = document.createElement("li");#}
{#        nextButton.className = "page-item";#}
{#        nextButton.innerHTML = `<a class="page-link" href="#" onclick="filterProducts(currentStore, ${Math.min(totalPages, currentPage + 3)}); return false;">Next</a>`;#}
{#        paginationDiv.appendChild(nextButton);#}
{#    }#}
{##}
{##}
{##}
{#// ë¼ë””ì˜¤ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì„¤ì •#}
{#document.addEventListener("DOMContentLoaded", function () {#}
{#    let radioButtons = document.querySelectorAll("input[name='store']");#}
{#    #}
{#    radioButtons.forEach(radio => {#}
{#        radio.addEventListener("change", function () {#}
{#            currentStore = this.value; // ì„ íƒí•œ í¸ì˜ì  ê°’ ì €ì¥#}
{#            filterProducts(currentStore, 1); // ìƒˆë¡œìš´ ì„ íƒê°’ìœ¼ë¡œ í•„í„°ë§ ì‹¤í–‰#}
{#        });#}
{#    });#}
{##}
{#    // ì´ˆê¸° ë°ì´í„° ë¡œë“œ#}
{#    filterProducts(currentStore, currentPage);#}


</script>

{% endblock script %}