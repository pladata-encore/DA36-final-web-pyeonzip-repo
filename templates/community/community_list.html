{% extends '../layout/base.html' %}
{% load static %}


{% block title %} Community List {% endblock %}

{% block content %}
    
        <!-- üìå Ïª§ÎÆ§ÎãàÌã∞ Î™©Î°ù -->
    {% for community in communities %}
    <div class="card mb-3">
        <div class="card-header">
            <span class="badge bg-primary">{{ community.category.categoryName }}</span>
            <strong>{{ community.communityTitle|truncatewords:20 }}</strong>
        </div>
        <div class="card-body">
            <p>{{ community.communityContent|truncatewords:100 }}</p>
        </div>
        <div class="card-footer d-flex justify-content-between align-items-center">
            <div>
                <img src="{{ community.author.profile.url }}" alt="User" width="20">
                <span>{{ community.author.user.username }}</span>
                <small class="text-muted">{{ community.created_at|date:"Y-m-d" }}</small>
            </div>
            <div>
                <button class="btn btn-outline-success btn-sm" onclick="voteCommunity({{ community.communityId }})">
                    üó≥Ô∏è +{{ community.vote_count  }}
                </button>
            </div>
        </div>
    </div>
    {% endfor %}

    {% endblock %}

{% block script %}
    <script>
    function voteCommunity(communityId) {
    fetch("{% url 'community:vote_community' %}", {
        method: "POST",
        headers: {
            "X-CSRFToken": "{{ csrf_token }}",
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ "communityId": communityId })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert("‚úÖ Ìà¨Ìëú ÏôÑÎ£å!");
            location.reload();
        } else {
            alert("‚ùå Ìà¨Ìëú Ïã§Ìå®: " + data.message);
        }
    })
    .catch(error => console.error("‚ùå Ìà¨Ìëú Ïò§Î•ò:", error));
}
    </script>

{% endblock %}